Modules.addCached("FontDylex7x13",function(){var a=atob("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"),
b=atob("AwIEBgYIBwIEBAYGAwYCBgYGBgYHBgYGBgYCAwUGBQYIBwcHBwcGBwcEBgcGBwcHBgcHBwgHBwgHCAcEBgQGCAMGBgYGBgYGBgMFBgMIBgYGBgYGBgYGCAYGBgYCBggABwADBgQGBgYGBwcECAAHAAADAwUFBgYIBQgGBAgABggAAgYGCAgCBgQIBQYFAAgIBQYFBQMIBwQDBAUGBwcIBgcHBwcHBwgHBgYGBgQEBAQIBwcHBwcHBgcHBwcHCAYIBgYGBgYGCAYGBgYGAwMEBAYGBgYGBgYGBgYGBgYGBgY=");exports.add=function(c){c.prototype.setFontDylex7x13=function(d){return this.setFontCustom(a,32,b,13|d<<8)}}});


g.clear();

/*
function drawDots(arr, x, y) {
  rad=2;
  s=rad+2;
  xoff=x*(rad+2)*6, yoff=y*(rad+2)*8;
  for(let c=0; c< 5; c++) {
    let col=arr[c];
    for(let r=0; r<7; r++) {
      if(col&1) g.fillRect(xoff+c*s, yoff+r*s, xoff+c*s+rad, yoff+r*s+rad);
      col >>= 1;
    }
  }
}
g.setColor(0).fillRect(0,0,175,175);
g.setColor(1,1,1);
drawDots( [32,16,8,4,2], 0, 0);
drawDots( [54,73,73,73,54], 1, 0);
drawDots( [1,1,113,9,7], 0, 1);


let segTop =  new Uint8Array([
  5,3,8,0,40,0,43,3,36,10,12,10
]);

let segTopLeft = new Uint8Array([
  0,8,3,5,10,12,10,41,4,47,0,43
  ]);

let segMiddle =  new Uint8Array([
  7,48,12,43,36,43,41,48,36,53,12,53
]);
segTopRight = () => {
  let arr = new Uint8Array(12);
  for(let i=0; i<segTopLeft.length; i+=2) {
    arr[i] = 48-segTopLeft[i];
    arr[i+1] = segTopLeft[i+1];
  }
  return arr;
};
segBottomRight = () => {
  let arr = new Uint8Array(12);
  for(let i=0; i<segTopLeft.length; i+=2) {
    arr[i] = 48-segTopLeft[i];
    arr[i+1] = 96-segTopLeft[i+1];
  }
  return arr;
};
segBottomLeft = () => {
  let arr = new Uint8Array(12);
  for(let i=0; i<segTopLeft.length; i+=2) {
    arr[i] = segTopLeft[i];
    arr[i+1] = 96-segTopLeft[i+1];
  }
  return arr;
};
segBottom = () => {
  let arr = new Uint8Array(12);
  for(let i=0; i<segTopLeft.length; i+=2) {
    arr[i] = segTop[i];
    arr[i+1] = 96-segTop[i+1];
  }
  return arr;
};
*/
(() => {
  g.clear().drawImage(
    {
    width : 240, height : 240, bpp : 1,
    buffer : require("heatshrink").decompress(atob("AH4A/AFs//4ABwAdYv4dC8AHCj4ULnAIH4ADCsAlDEQYAHvwIH5+fz+/mAHCIAgdQ74dF4YdMMxAdD2EAgJ8FAA8PU44dGj4dLgOHRoYdH3wPBh//CA4ACgfDDp0HDpnjJA4dGwf/NQ5ZD+IdNgAdBShUADp9B/wcKnF5Dp1w/gdKvgdMaIMA/H4DpX8DqFwDpX+DpkwDpw7J54dBjwdClEgO6nAAYQdCgwdLnEwDo9//4ABBYUDsDvLABE/DoQ/CgJDDADOADrgA/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AE//AAIcZgYdCwAGBh4FB+EAn4EB4AdRCQQYC/BGD8AdNgI7FDoX8DoZABABkMCIP+kAGBj47Dv47PhEcCQP8uAHB54YB8UDIAWIDpk4jwSB/BOBgPHDAPHg5ACjgdMvkfCQPxDoXjDAOPg+PMgM8Dpn8j4SB84dC+IdBj8HIAP8vixMDoJxB54dC/A2Bv8HIAP5XALtLDoKlBj4dC/g2B/8H+f/+YdMg/8n4aBAQUB/z4Cg7TBB4IdLh4dGgf/AQQMBB4QdLj4d/DrP4Du1/h0cDreejwdaufeDrdh78+DrVgDqkP/4DBn//CQI7Vj///yRB//4AYOfmwdEv/wnwdMBYIdBA4N/zNmDpUHDocfDoYZCLIVgjPmDqVP//5wJ3B8wdW8//+eDz//5wdC9wdS+f/8+D5//zwdC5wdS/P/5+DH4M+DoMY5gdSAgWDCYN+gAACDqTtBn+DdoIFBDsfgDoV+DrwNBDoQUBDuPgDsX+DoYXDv4dBgIdLngdaAQQdVCAM/4ASBDogCBDoQCBC4V/w4dGg/4j+H//HDoSNBCAMP+APCDpcD/EOj//8eADQP4v/8v0H8P/+IdMgHggl//5QBAAIYB/04gZGB/HgDpgAB///KoIABo4GBwEBIwIUBDpsBDosPAwKeBn4EBDpw7CLIY2BDoRkBDp8GGAPxHYqbBBQJZO4EPGoPnGoMAsYdBiEBx5kBoAdLgPgj4SBx7vBgHxGwN8gfH//5+DvM+E/HAMfDoLvBPoP+g/jfQLvMh/4n4aBv4CBga3BCAMP+EAg4dMj4dHBoMHDoK8BB4MBE4M/w4mBDok/DqcfDoV+DpSQBDpEAQIPPwaABnwdWbYPmbQWYDq0PXoIWB/7kCDqkfDoV/Do6SCHZ6TBHYPADpYaBDoQ4DO5wdQ+P/x8D4/+ngdE+AdPgKTCw4TBB4IdV/gPBw/wgId/Dv4d/DQQdY/4dih4dDn4d/v8HDoIFBDsfADoICBDrwNBh/8j/wB4Qd/Ds4ECEAQdVCAQiCDoIACEAQPDC4X/DoMDDokPLIP//8fDogQEB4IdLA4IdCx5ZCAoPxLIIEB44dMgYdD44dE/AdD8aHEAQJ3FgIdD8YdE/l8DoXxQ4gDCDokADofxDon+ngdC/BTBAgOfh4MBvgdEsE/CQR/CAoP/jgdC/lwgIEB54NCngdEIwISCP4QdCwAyBGYJrBAgPnDoWcDoowCCQIdE4AdC/4dD+QdC5AdFCQQ7CCYX/8BeDwAJC/AIC8AdFGoQJDHYZADBIf8BAS7DABJ+BL4SgEYgP4H4Q7GAH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AH4A/AEwA=="))
  }, 0,0);
})();

// segments are 12 bytes each; ordered top,topL,topR,mid,botL,botR,bottom
const segdata = new Uint8Array([5, 3, 8, 0, 40, 0, 43, 3, 36, 10, 12, 10,
  0, 8, 3, 5, 10, 12, 10, 41, 4, 47, 0, 43,
  48, 8, 45, 5, 38, 12, 38, 41, 44, 47, 48, 43,
  7, 48, 12, 43, 36, 43, 41, 48, 36, 53, 12, 53,
  0, 88, 3, 91, 10, 84, 10, 55, 4, 49, 0, 53,
  48, 88, 45, 91, 38, 84, 38, 55, 44, 49, 48, 53,
  5, 93, 8, 96, 40, 96, 43, 93, 36, 86, 12, 86
]);
/*
const segdata = new Uint8Array(E.toArrayBuffer(atob('BQMIACgAKwMkCgwKAAgDBQoMCikELwArMAgtBSYMJiksLzArBzAMKyQrKTAkNQw1AFgDWwpUCjcEMQA1MFgtWyZUJjcsMTA1BV0IYChgK10kVgxW')));
*/


function drawSegment(seg, xoff, yoff, xscale, yscale) {
  let arrTmp = new Uint8Array(12);
  let beg = seg * 12;
  for(let i=0; i<12; i+=2) {
    arrTmp[i] = segdata[beg+i]*xscale+xoff;
    arrTmp[i+1] = segdata[beg+i+1]*yscale+yoff;
  }
  g.fillPoly(arrTmp,true);
}

function drawDigit(d, x, y, xscale, yscale) {
  let mask = [0x77,0x24,0x5d,0x6d,0x2e,0x6b,0x7b,0x25,0x7f,0x6f,0][d];
  for(let s=0; s<7; s++) {
    // special case: first digit, only draw 2 segs (2 & 5)
    if( ! x &&  s!=2 && s!=5 ) {
      //print(`x=${x} d=${d} s=${s} mask=${mask}  continuing`);
    } else {
      if(mask & 1)  g.setColor(1,1,1);
      else g.setColor(0,0,0);
      //if((mask & 1) || (d != 1) || x) 
      drawSegment(s, x, y,xscale, yscale);
    }
    mask >>= 1;
  }
}

let lastTime = '';
let lastDate = '';
g.setColor(0,0,0);
g.fillRect(26,72,239,170);

g.setBgColor(0,0,0).setColor(1,1,1).fillCircle(87,120,2).fillCircle(87,152,2);
//g.setFont("6x8",2)
require("FontDylex7x13").add(Graphics);
g.setFont("Dylex7x13",2).setFontAlign(0,0);

function clrDtWdw(r,gr,b) {
  g.setColor(r,gr,b).fillRect(0,172,239,239).setColor(1,1,1);  
}

function drawDate(dt) {
  //let dtstr = dt.toString().substring(0,16);
  let m = dt.getMonth()+1;
  let d = dt.getDate();
  if(lastDate != d) {
    lastDate = d;
    let digs = [Math.floor(m / 10), m % 10, Math.floor(d / 10), d % 10];
    clrDtWdw(0,0,0);
    g.drawLine(116,235,124,179).drawLine(117,235,125,179);
    for(let d = 0; d < digs.length; d++) {
      if(!d && !digs[d]) continue;
      drawDigit(digs[d], [72,94,130,152][d], 182, 0.4, 0.5);
    }
  }
}

function drawBattery(b) {
  g.setColor(0,0,0).fillRect(195,8,224,22);
  g.setColor(1,1,1);
  if(b > 35) g.fillRect(196,9,203,20);
  if(b > 55) g.fillRect(205,9,212,20);
  if(b > 75) g.fillRect(214,9,221,20);
}

function showMsg(m) {
  clrDtWdw(0,0.3,0.1);
  m.split('|').forEach((s,i)=>{g.drawString(s,120, 190+i*28);});
  //(m, 120, 186);
  //lastDate = '';
  [400,800,1200,2000,2400].forEach((t) => {setTimeout(Bangle.buzz, t, 175);});
}

let tikint = 0;

function clock() {
  let dt = new Date();
  let tm = dt.toString().substring(16,21);
  drawDate(dt);
  let hr = dt.getHours();
  if(hr >= 12) {
    ampm = 'pm';
    hr -= 12;
  }
  if(!hr)  hr=12;

  if(tm != lastTime) {
    lastTime = tm;
    let digs = [Math.floor(hr / 10), hr % 10, Math.floor(dt.getMinutes() / 10), dt.getMinutes() % 10];
    for(let d = 0; d < digs.length; d++) {
      if(!d && !digs[d]) { digs[d]=10; }
      drawDigit(digs[d], [0,44,90,130][d], 72, 0.8, 1);
    }
    drawBattery(E.getBattery());
    g.drawString(analogRead(D31).toFixed(4),120, 40, true);
  }
  tick(dt.getSeconds());
  if(wOS.time_left <= 0) {
    clearInterval(tikint);
    tikint=0;
  }
}

function tick(s) {
  //let s = new Date().getSeconds();
  let digs = [Math.floor(s / 10), s % 10];
  for(let d = 0; d < digs.length; d++) {
    drawDigit(digs[d], [180,210][d], 94, 0.6, 0.75);
  }
}

let logD = () => {}; //console.log;
let alarmTOs = [];
let schAls = (als) => {
  for(let idx=0; idx < alarmTOs.length; idx++) {
    clearTimeout(alarmTOs[idx]);
  }
  alarmTOs = [];
  for(let idx=0; idx < als.length; idx++) {
    //logD('idx = '+idx);
    let tdiff = Date.parse(als[idx].time) - Date.now();
    let msg = als[idx].msg;
    if(tdiff > 0) {
      //logD(`will alarm ${msg} in ${tdiff}`);
      alarmTOs.push(setTimeout(showMsg, tdiff,als[idx].msg));
    } else {
      //expired
      //logD('tossing out' + idx);
    }
  }
};

function showClock() {
  clock();
  if(! tikint) {
    tikint = setInterval(clock, 1000);
  }
}
ACCEL.on("faceup", showClock);
//wOS.wake();  don't... doubles up the timer
// swipe dn (1) use it to reset/reprint date
wOS.showLauncher = () => {};
setWatch(()=>{
  lastDate = -1;
}, BTN2, {repeat:1,edge:"falling"});

/*
schAls( [
    {"time":"2022-12-29T14:43:00", "msg":"JUST TESTING|RELAX..."},
    {"time":"2022-12-29T15:10:00", "msg":"SET UP BRENDA"},
    {"time":"2022-06-24T19:30:00", "msg":"MIRANDA"},
]);
*/
